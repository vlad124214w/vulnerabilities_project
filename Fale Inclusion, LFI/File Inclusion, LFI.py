## 1. Уязвимый пример загрузки файла (LFI)

### Файл: `index.php`


# // Уязвимый скрипт для включения произвольных файлов
if (isset($_GET['page'])) {
    include($_GET['page']); // Уязвимость: позволяет включать любые файлы
} else {
    echo "Главная страница.";
}


### Как это работает:
- В адресной строке можно указать параметр `page`, который подставляется в команду `include()`.
- Например: `http://localhost/index.php?page=../../etc/passwd` — это вызовет попытку включения файла `/etc/passwd` (на UNIX системах), что безопасно только дляначала, так как сервер далее не проверяет правильность файла.

### Почему это опасно:
- Злоумышленник может включить системные или конфигурационные файлы сервера, что может привести к утечке данных.
- В реальной ситуации это одна из самых распространенных уязвимостей.

---

## 2. Безопасный пример загрузки файла с контролем путей и типов

### Файл: `download.php`
```php
<?php
// Директория, где хранятся разрешенные файлы
$base_dir = __DIR__ . '/files/';

// Допустимые расширения файлов
$allowed_types = ['txt', 'csv', 'pdf'];

if (isset($_GET['file'])) {
    $file = $_GET['file'];
    $file_path = realpath($base_dir . $file);

    // Проверка, что запрошенный файл подчиняется базовой директории
    if (strpos($file_path, realpath($base_dir)) !== 0) {
        exit('Ошибка: недопустимый путь.');
    }

    // Проверка расширения файла по разрешенным типам
    $ext = pathinfo($file_path, PATHINFO_EXTENSION);
    if (!in_array($ext, $allowed_types)) {
        exit('Ошибка: недопустимый тип файла.');
    }

    // Проверка существования файла
    if (file_exists($file_path)) {
        header('Content-Type: application/octet-stream');
        header('Content-Disposition: attachment; filename=' . basename($file_path));
        readfile($file_path);
    } else {
        echo 'Файл не найден.';
    }
} else {
    echo 'Пожалуйста, выберите файл для скачивания.';
}
?>
```

---

## 3. Создание каталога с файлами

Создайте папку `files` в том же каталоге, где находится ваш `download.php`. Внутри этой папки добавьте несколько тестовых файлов с расширениями: `.txt`, `.csv`, `.pdf`, например:

- `example.txt`
- `report.csv`
- `document.pdf`

Эти файлы могут содержать любые тестовые данные.

---

## Как проверить работу защищенного скрипта:

1. Заходим по адресу:

```
http://localhost/download.php?file=example.txt
```

2. Сервер должен ответить, предложив загрузить файл `example.txt`.

3. Попытка указать недопустимый тип файла, например:

```
http://localhost/download.php?file=script.php
```

— выведет сообщение о недопустимом типе файла.

4. Попытка указать путь вне `files/` (например, `../../etc/passwd`) — завершится ошибкой.

---

## Итог

- Уязвимый пример показывает, что писать `include()` с непроверенными входными данными опасно!
- Безопасный пример использует `realpath()` для проверки пути и контроль расширений — так исключаются многие атаки.